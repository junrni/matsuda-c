<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ピアノレッスン予約システム</title>
  <style>
    /* スタイル省略 */
  </style>
</head>
<body>
  <div class="container">
    <!-- ログイン画面 -->
    <div id="loginScreen" class="screen active">
      <div class="card">
        <h2>ログイン</h2>
        <div class="form-group">
          <label for="studentId">受講者番号（7桁）</label>
          <input id="studentId" type="text" maxlength="7" placeholder="1234567">
        </div>
        <div class="form-group">
          <label for="password">パスワード</label>
          <input id="password" type="password" placeholder="demo1234">
        </div>
        <p>※デモ用ID: <strong>1234567</strong> / PW: <strong>demo1234</strong></p>
        <button class="btn" onclick="login()">ログイン</button>
      </div>
    </div>

    <!-- ログインエラー画面 -->
    <div id="loginErrorScreen" class="screen">
      <div class="card error-message">
        <h3>ログインエラー</h3>
        <p>IDまたはパスワードが違います。</p>
      </div>
      <button class="btn-secondary btn" onclick="showScreen('loginScreen')">戻る</button>
    </div>

    <!-- 予約画面 -->
    <div id="reservationScreen" class="screen">
      <div class="card">
        <h2>🎹 レッスン予約</h2>
        <!-- ログインユーザー表示 -->
        <p>ログイン中のユーザーID: <strong><span id="currentUserDisplay"></span></strong></p>
        <!-- 講師は1名のみ -->
        <div class="lesson-info">
          <h3>講師: 田中先生</h3>
        </div>

        <!-- 日付選択 -->
        <h3>📅 レッスン日</h3>
        <div class="calendar-header">
          <button class="calendar-nav" onclick="changeMonth(-1)">◀</button>
          <div id="currentMonth" class="calendar-month"></div>
          <button class="calendar-nav" onclick="changeMonth(1)">▶</button>
        </div>
        <div id="calendar" class="calendar"></div>

        <!-- 時間帯選択 -->
        <div id="timeSection" class="time-slots"></div>

        <!-- 複数ユーザーID入力 -->
        <div class="form-group">
          <label for="userIds">ユーザーID (カンマ区切りで複数入力)</label>
          <input id="userIds" type="text" placeholder="1234567,2345678,3456789">
        </div>

        <button class="btn" onclick="reserveSequential()">予約する</button>
      </div>
    </div>

    <!-- 確認画面 -->
    <div id="confirmScreen" class="screen">
      <div class="card success-message">
        <h3>🎉 予約完了</h3>
        <div id="confirmInfo"></div>
      </div>
      <button class="btn" onclick="showScreen('reservationScreen')">戻る</button>
    </div>
  </div>

  <script>
    let currentDate = new Date();
    let selectedDate = null;
    let selectedTime = null;
    let currentUserId = null; // ログインユーザーID
    const bookings = {};

    // 初期画面切り替え
    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // ログイン
    function login() {
      const id = document.getElementById('studentId').value;
      const pw = document.getElementById('password').value;
      if (id === '1234567' && pw === 'demo1234') {
        currentUserId = id; // 設定
        document.getElementById('currentUserDisplay').textContent = currentUserId;
        document.getElementById('userIds').value = currentUserId;
        showScreen('reservationScreen');
        initCalendar();
      } else {
        showScreen('loginErrorScreen');
      }
    }

    // カレンダー生成
    function initCalendar() {
      updateCalendar();
    }
    function updateCalendar() {
      const monthNames = ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'];
      document.getElementById('currentMonth').textContent = `${currentDate.getFullYear()}年 ${monthNames[currentDate.getMonth()]}`;
      const cal = document.getElementById('calendar');
      cal.innerHTML = '';
      ['日','月','火','水','木','金','土'].forEach(d => {
        const el = document.createElement('div');
        el.className = 'calendar-day weekday-name';
        el.textContent = d;
        cal.appendChild(el);
      });
      const first = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
      for (let i = 0; i < first.getDay(); i++) {
        const empty = document.createElement('div');
        empty.className = 'calendar-day other-month';
        cal.appendChild(empty);
      }
      const last = new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 0);
      for (let d = 1; d <= last.getDate(); d++) {
        const el = document.createElement('div');
        el.className = 'calendar-day';
        el.textContent = d;
        const key = `${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const dayDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), d);
        if (dayDate < new Date()) {
          el.classList.add('other-month');
        } else {
          el.classList.add(bookings[key] && bookings[key].full ? 'fully-booked' : 'available');
          el.onclick = () => selectDate(key, el);
        }
        cal.appendChild(el);
      }
    }

    // 月送り
    function changeMonth(dir) {
      currentDate.setMonth(currentDate.getMonth() + dir);
      selectedDate = null;
      document.getElementById('timeSection').innerHTML = '';
      updateCalendar();
    }

    // 日付選択
    function selectDate(date, el) {
      if (bookings[date] && bookings[date].full) return;
      document.querySelectorAll('.calendar-day.selected').forEach(s => s.classList.remove('selected'));
      el.classList.add('selected');
      selectedDate = date;
      showTimeSlots();
    }

    // 時間帯表示
    function showTimeSlots() {
      const container = document.getElementById('timeSection');
      container.innerHTML = '';
      const slots = ['09:00','10:00','11:00','13:00','14:00','15:00','16:00','17:00','18:00'];
      slots.forEach(t => {
        const btn = document.createElement('div');
        btn.className = 'time-slot' + ((bookings[selectedDate] && bookings[selectedDate].slots && bookings[selectedDate].slots.includes(t)) ? ' booked' : '');
        btn.textContent = t;
        if (!btn.classList.contains('booked')) btn.onclick = () => selectTime(btn, t);
        container.appendChild(btn);
      });
    }

    // 時間選択
    function selectTime(el, time) {
      document.querySelectorAll('.time-slot.selected').forEach(s => s.classList.remove('selected'));
      el.classList.add('selected');
      selectedTime = time;
    }

    // 順番予約
    function reserveSequential() {
      const ids = document.getElementById('userIds').value.split(',').map(v=>v.trim()).filter(v=>v);
      if (!selectedDate || !selectedTime || ids.length === 0) {
        alert('日付・時間・ユーザーIDを正しく入力してください'); return;
      }
      if (!bookings[selectedDate]) bookings[selectedDate] = { slots: [], full: false };
      bookings[selectedDate].slots.push(selectedTime);
      bookings[selectedDate].full = true;
      document.getElementById('confirmInfo').innerHTML = `
        <p>講師: 田中先生</p>
        <p>日時: ${selectedDate} ${selectedTime}</p>
        <p>ユーザー: ${ids.join(', ')}</p>
      `;
      showScreen('confirmScreen');
    }
  </script>
</body>
</html>
